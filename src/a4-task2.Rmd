---
title: "Juvenile snowshoe hares - exploratory report"
author: "By: Lauren Skube"
date: "11/15/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(effsize)
library(broom)
library(beeswarm)
library(kableExtra)
library(lubridate)
```

### 1. Overview

Write an overview of the report here. 

```{r, include=FALSE, message=FALSE}
bonanza_hares <- read.csv(here("data" , "bonanza_hares.csv")) # Read in the data using the here() function

```


### 2. Data and analyses 

### 3. Exploratory findings 


#### A. Annual juvenile hare trap counts 

```{r, include=FALSE}
juv_hares <- bonanza_hares %>% 
  filter(age == "j") %>% # Create a subset that only contains juveniles
  mutate(date = mdy(date)) %>% # Change the date column to "date" class
  mutate(year = year(date)) %>% # Add a new column for the year 
  mutate(sex_full = case_when( # Add a new column with the full name of the sex 
    sex %in% c("f") ~ "Female" ,
    sex %in% c("m") ~ "Male"))
  
juv_grid_full <- juv_hares %>% # Create a subset with the full name for grid sites
  mutate(grid_full = case_when(
      grid %in% c("bonrip") ~ "Bonanza Riparian" ,
      grid %in% c("bonmat") ~ "Bonanza Mature" ,
      grid %in% c("bonbs") ~ "Bonbs"))

juv_hares_counts <- juv_hares %>% 
  count(year) # Create a table containing the number of juvenile hare trappings per year

# Summary statistics for juvenile trapping counts
juv_stats <- juv_hares_counts %>% 
  summarize(mean_counts = mean(n), 
            median_counts = median(n), 
            min_counts = min(n), 
            max_counts = max(n))

```

```{r juv_trappings_graph, echo=FALSE}

# Create a bar graph for juvenile trappings per year 
ggplot(data = juv_hares_counts, aes(x= year, y = n)) +
  geom_col(color = "darkslategrey", fill = "darkslategrey") +
  labs(x = "Year" , 
       y = "Total counts of juvenile trappings") +
  scale_x_continuous(breaks = c(1998, 2000, 2002, 2004, 2006, 2008, 2010, 2012)) + # Customize x scale
  theme_minimal()
```

**Figure 1.** Total number of juvenile snowshoe hare trappings by year (1999 to 2012) across all grid sites in Bonanza Creek Experimental Forest, Alaska. Data: Kielland et al. (2017). 

Talk about major takeaways from the figure here. Talk about major takeaways from the figure here. Talk about major takeaways from the figure here. Talk about major takeaways from the figure here. 

#### B. Visualization of juvenile hare weights 

```{r, echo=FALSE, warning=FALSE}

# Create boxplot with male and female weights by grid site
ggplot(juv_grid_full, aes(x= sex_full, y = weight, fill = sex_full)) +
  geom_boxplot(size = 0.75, # Increase thickness of lines
               outlier.color = "black") + # Show outliers in black 
  facet_wrap(~grid_full) + # Separate by grid site
  labs(x = "Sex", 
       y = "Weight (g)") + 
  #Overlay with a jitterplot to show individual observations
  geom_jitter(alpha = 0.4, # Customize transparency of points
              width = 0.15) + # Reduce jitter width
  theme_light() +
  theme(legend.position = "none") # Remove the legend

```

**Figure 2.** Insert figure caption here.

Talk about main takeaways here. 

#### **C. Juvenile weight comparison (male and female snowshoe hares)**

**Table 1.** insert table caption here. 
```{r, echo=FALSE, message=FALSE}

# Create a table of summary statistics for juvenile hare weights
juv_hares %>% 
  drop_na(weight) %>% 
  drop_na(sex_full) %>% # Remove NA values 
  group_by(sex_full) %>% 
  summarise(
    mean_weight = mean(weight) ,
    sd_weight = sd(weight),
    sample_size = n()
    ) %>% 
  # format summary statistics in a nice table
  kbl(col.names = c("Sex" , "Mean", "Standard deviation" , "Sample size")) %>% 
  kable_styling()


```
```{r, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
# Create a subset that does not include NA values 
juv_hares_clean <- juv_hares %>% 
  drop_na(weight)

# T-Test code:

# Actual difference in means between males and females: 90.568 g 
945.8589-855.3909

# Percent difference: 
90.468/((945.8589+855.3909)/2) * 100

# Create a vector of weight observations for males
m_weight <- juv_hares_clean %>% 
  filter(sex == "m") %>% 
  pull(weight) 

# Create a vector of weight observations for females 
f_weight <- juv_hares_clean %>% 
  filter(sex == "f") %>% 
  pull(weight) 

# Run the t-test 
weight_ttest <- t.test(m_weight, f_weight) 

# Effect size (Cohen's d): 
cohen.d(m_weight , f_weight)


```
```{r, echo=FALSE, include=FALSE}
# Exploratory graphs to check assumptions of t-test

# Create a quantile-quantile graph to compare sample to normality
ggplot(data = juv_hares_clean, aes(sample = weight)) + 
  geom_qq() +
  facet_wrap(~sex)

# Create a histogram to compare sample to normality 
ggplot(data = juv_hares_clean, aes(x = weight)) + 
  geom_histogram() + 
  facet_wrap(~sex)

```

Insert statement about the means comparison here. Talk about actual difference, percent difference, significance in regards to t-test, and effect size in regards to Cohen's d.

#### D. Relationship between juvenile hare weight and hind foot length 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Create a scatterplot for weight vs hind foot length
ggplot(data = juv_hares_clean, aes(x = hindft, y=weight)) + 
  geom_point(color = "darkslategrey") +
  labs(x = "Hind foot length (mm)" , 
       y = "weight (g)") +
  theme_light()
```

**Figure 3.** Insert figure caption here. 


#### C. Linear regression analysis 
```{r, echo=FALSE, include=FALSE, message=FALSE}
# Try out linear regression:

# model it with the lm() function 
juveniles_lm <- lm(weight ~ hindft, data = juv_hares_clean)

summary(juveniles_lm)
```
Multiple r-squared value is 0.2988, meaning that 29.9% of variance in juvenile snowshoe weight is explained by hind foot length. 

The slope is 9.5234. The y-intercept is -279.34. 

Describe what these values mean 

Simple linear regression was used to explore the relationship between juvenile snowshoe hare hind foot length (mm) and weight (g) across all grid sites, and including both male and female juveniles. A significant regression model was found (Î² = 9.52, F(1,247) = 105.2, p < 0.001) with an R2 of 0.299.

```{r, include=FALSE, echo=FALSE}

# Check residual assumptions 
plot(juveniles_lm)

# first plot shows a clear trend in variance - assumption of homoscedasticity is violated, residuals are not distributed evenly or randomly
# second plot - shows residuals are not normally distributed about the model 
# fourth plot - labeled observations are outliers that may have too much leverage in the model 
```
Talk about these concerns when expressing worries over assumption of linear regression. 
